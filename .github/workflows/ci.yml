name: CI

on:
  push:
  pull_request:

jobs:
  extract-vars:
    name: Extract Variables from Taskfile
    runs-on: ubuntu-latest # GitHub Runner VM image
    outputs:
      go-version: ${{ steps.extract.outputs.GO_VERSION }}
      golangci-lint-version: ${{ steps.extract.outputs.GOLANGCI_LINT_VERSION }}
      modules: ${{ steps.extract.outputs.MODULES }}
      air-version: ${{ steps.extract.outputs.AIR_VERSION }}
      buf-version: ${{ steps.extract.outputs.BUF_VERSION }}
      goose-version: ${{ steps.extract.outputs.GOOSE_VERSION }}
      lefthook-version: ${{ steps.extract.outputs.LEFTHOOK_VERSION }}
      app-name: ${{ steps.extract.outputs.APP_NAME }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4.2.2

      - name: Extract variables from Taskfile
        id: extract
        run: |
          chmod +x .github/scripts/extract-versions.sh
          .github/scripts/extract-versions.sh

  debug-vars:
    name: Debug extracted variables
    needs: extract-vars
    runs-on: ubuntu-latest
    steps:
      - name: Show all extracted variables
        run: |
          echo "=== Extracted Variables ==="
          echo "GO_VERSION: ${{ needs.extract-vars.outputs.go-version }}"
          echo "GOLANGCI_LINT_VERSION: ${{ needs.extract-vars.outputs.golangci-lint-version }}"
          echo "MODULES: ${{ needs.extract-vars.outputs.modules }}"
          echo "AIR_VERSION: ${{ needs.extract-vars.outputs.air-version }}"
          echo "BUF_VERSION: ${{ needs.extract-vars.outputs.buf-version }}"
          echo "GOOSE_VERSION: ${{ needs.extract-vars.outputs.goose-version }}"
          echo "LEFTHOOK_VERSION: ${{ needs.extract-vars.outputs.lefthook-version }}"
          echo "APP_NAME: ${{ needs.extract-vars.outputs.app-name }}"

  # lint:
  #   needs: extract-vars
  #   uses: ./.github/workflows/lint-reusable.yml
  #   with:
  #     modules: ${{ needs.extract-vars.outputs.modules }}
  #     go-version: ${{ needs.extract-vars.outputs.go-version }}
  #     golangci-lint-version: ${{ needs.extract-vars.outputs.golangci-lint-version }}
